<!DOCTYPE html>
<html lang="nl-BE">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch Pokémon</title>
    <link rel="stylesheet" href="/css/test.css">
    <link rel="stylesheet" href="/css/reset.css">
</head>

<body>
    <header>

    </header>

    <section class="searchAndFilter">
        <form id="searchForm" action="/search" method="get">
            <input type="text" name="search" placeholder="Search Pokémon">
            <select name="generation">
                <option value="">Any Generations</option>
                <% generations.forEach(gen=> { %>
                    <option value="<%= gen %>">
                        <%= gen %>
                    </option>
                    <% }); %>
            </select>
            <select name="type">
                <option value="">Any Types</option>
                <% types.forEach(type=> { %>
                    <option value="<%= type %>">
                        <%= type %>
                    </option>
                    <% }); %>
            </select>
            <button type="submit">Search</button>
        </form>
    </section>

    <main>
        <section class="pokemonContainer">
            <% pokemons.forEach(pokemon=> { %>
                <article class="pokemonCard" data-types="<%= pokemon.types %>">
                    <img src="<%= pokemon.image %>" alt="<%= pokemon.name %>" class="pokemonImage">
                    <div class="pokemonInfo">
                        <h2 class="pokemonName">
                            <%= pokemon.name %> (#<%= pokemon.id %>)
                        </h2>
                        <p class="pokemonTypes">Type: <%= pokemon.types %>
                        </p>
                    </div>
                </article>
                <% }); %>
        </section>
        <button id="loadMore" onclick="loadMore()">View More</button>
    </main>

    <script>

        const typeColors = {
            normal: '#A8A878',
            fire: '#F08030',
            water: '#6890F0',
            electric: '#F8D030',
            grass: '#78C850',
            ice: '#98D8D8',
            fighting: '#C03028',
            poison: '#A040A0',
            ground: '#E0C068',
            flying: '#A890F0',
            psychic: '#F85888',
            bug: '#A8B820',
            rock: '#B8A038',
            ghost: '#705898',
            dragon: '#7038F8',
            dark: '#705848',
            steel: '#B8B8D0',
            fairy: '#EE99AC',
        };

        function applyTypeBackgrounds() {
            const cards = document.querySelectorAll('.pokemonCard[data-types]');

            cards.forEach(card => {
                const types = card.getAttribute('data-types').toLowerCase().split(',');
                const colors = types.map(type => typeColors[type.trim()]);

                if (colors.length === 1) {
                    card.style.background = colors[0];
                } else {
                    card.style.background = `linear-gradient(to bottom, ${colors[0]} 0%, ${colors[1]} 100%)`;
                }
            });
        }

        applyTypeBackgrounds();

        var currentPage = 1;
        function loadMore() {
            currentPage++;
            fetch('/catch?page=' + currentPage)
                .then(response => response.text())
                .then(html => {
                    var tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;

                    var pokemonCards = tempDiv.querySelectorAll('.pokemonCard');
                    if (pokemonCards.length) {
                        pokemonCards.forEach(card => {
                            document.querySelector('.pokemonContainer').appendChild(card);
                            applyTypeBackgrounds();
                        });
                    } else {
                        document.getElementById('loadMore').style.display = 'none';
                    }
                })
                .catch(err => console.error('Error loading more Pokémon:', err));
        }

    </script>
    <footer>
        <p>&copy; <%= new Date().getFullYear() %> Pokeverse. All rights reserved.</p>
    </footer>
</body>

</html>


<!--    <section class="catchPopup">
        <button class="closeBtn">&times;</button>
        <section>
            <h2>Pikachu</h2>
        <figure>
            <img src="assets/compare2.gif" alt="Article Image">
        </figure> 
        <article class="catchStats">
            <h2>Stats</h2>
            <p>100</p>
        </article> 
        <article class="catchButton">
            <button class="catchBtn"><img src="assets/pokeball.png" alt=""></button>
        </article>
        </section>
    </section>
    </main>
    -->